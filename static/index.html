<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI XMind Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid #e5e7eb;
        }

        .input-focus {
            transition: all 0.2s;
        }

        .input-focus:focus {
            ring: 2px;
            ring-color: #3b82f6;
            border-color: transparent;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>

<body class="h-screen flex flex-col text-slate-800">

    <div id="app" class="flex-1 flex flex-col h-full">
        <!-- Header -->
        <header class="bg-white border-b border-slate-200 px-6 py-4 flex items-center justify-between shadow-sm z-10">
            <div class="flex items-center gap-3">
                <div
                    class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold text-lg shadow-blue-200 shadow-lg">
                    X</div>
                <h1 class="text-xl font-semibold tracking-tight text-slate-900">AI XMind Generator</h1>
            </div>
            <div class="flex items-center gap-4">
                <a href="https://github.com/txt2xmind" target="_blank"
                    class="text-sm text-slate-500 hover:text-slate-800 transition">GitHub</a>
                <button @click="showSettings = !showSettings"
                    class="p-2 hover:bg-slate-100 rounded-full transition text-slate-600">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path
                            d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z">
                        </path>
                        <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Main Content (Split View) -->
        <main class="flex-1 flex overflow-hidden">

            <!-- Left: Input -->
            <div class="flex-1 flex flex-col border-r border-slate-200 bg-white p-6 gap-4 min-w-[320px]">
                <div class="flex items-center justify-between">
                    <label class="text-sm font-semibold text-slate-700">原始文本 / 需求描述</label>
                    <span class="text-xs text-slate-400 bg-slate-50 px-2 py-1 rounded">Markdown / Plain Text</span>
                </div>
                <textarea v-model="rawText"
                    class="flex-1 w-full bg-slate-50 border border-slate-200 rounded-xl p-4 text-sm font-mono leading-relaxed resize-none focus:outline-none focus:bg-white focus:ring-2 focus:ring-blue-100 focus:border-blue-400 transition"
                    placeholder="请输入一段文本，AI 将自动为您整理成思维导图结构...&#10;&#10;例如：&#10;帮我整理一份关于 Python 学习路线的脑图，包含基础语法、数据结构、常用库和Web开发框架。"></textarea>

                <div v-if="showSettings"
                    class="bg-slate-50 p-4 rounded-xl border border-slate-200 space-y-3 animate-fade-in-down">
                    <h3 class="text-xs font-bold text-slate-500 uppercase tracking-wider">API 配置</h3>
                    <div class="grid gap-3">
                        <div>
                            <input type="password" v-model="apiKey" placeholder="API Key (sk-...)"
                                class="w-full text-xs p-2 rounded border border-slate-300 focus:border-blue-500 outline-none">
                            <p class="text-[10px] text-slate-400 mt-1">留空则不使用 AI，仅按缩进生成</p>
                        </div>
                        <div>
                            <input type="text" v-model="baseUrl"
                                placeholder="Base URL (Optional, e.g. https://api.openai.com/v1)"
                                class="w-full text-xs p-2 rounded border border-slate-300 focus:border-blue-500 outline-none">
                        </div>
                    </div>
                </div>

                <div class="flex items-center gap-3">
                    <select v-model="layout"
                        class="text-sm border border-slate-200 rounded-lg px-3 py-2.5 bg-white text-slate-600 focus:border-blue-400 outline-none cursor-pointer hover:bg-slate-50">
                        <option value="right">向右逻辑图 (Right)</option>
                        <option value="map">中心发散图 (Map)</option>
                        <option value="tree">树状图 (Tree)</option>
                        <option value="org">组织架构图 (Org)</option>
                    </select>

                    <button @click="generate" :disabled="isLoading || !rawText.trim()"
                        class="flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 disabled:cursor-not-allowed text-white font-medium py-2.5 px-4 rounded-lg shadow-sm shadow-blue-200 transition flex items-center justify-center gap-2">
                        <span v-if="isLoading"
                            class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></span>
                        <span v-else>✨ 生成思维导图</span>
                    </button>
                </div>
            </div>

            <!-- Right: Result -->
            <div
                class="flex-1 flex flex-col bg-slate-50/50 p-6 gap-4 min-w-[320px] justify-center items-center relative">

                <!-- Background Decoration -->
                <div class="absolute inset-0 flex items-center justify-center opacity-5 pointer-events-none">
                    <svg width="200" height="200" viewBox="0 0 24 24" fill="none" class="text-slate-900">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" stroke="currentColor"
                            stroke-width="1" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </div>

                <!-- Empty State -->
                <div v-if="!downloadUrl && !isLoading" class="text-center space-y-4 z-10">
                    <div
                        class="w-16 h-16 bg-slate-100 rounded-2xl flex items-center justify-center mx-auto text-slate-400">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                    </div>
                    <div>
                        <h3 class="text-lg font-medium text-slate-700">准备生成</h3>
                        <p class="text-sm text-slate-500">在左侧输入内容，点击生成即可获取 XMind 文件</p>
                    </div>
                </div>

                <!-- Loading State -->
                <div v-if="isLoading" class="flex flex-col items-center gap-6 z-10">
                    <div class="relative">
                        <div class="w-20 h-20 border-4 border-slate-200 rounded-full"></div>
                        <div
                            class="w-20 h-20 border-4 border-blue-500 rounded-full border-t-transparent animate-spin absolute top-0 left-0">
                        </div>
                    </div>
                    <div class="text-center space-y-2">
                        <h3 class="text-lg font-medium text-slate-800 animate-pulse">{{ statusMessage }}</h3>
                        <p class="text-sm text-slate-500">正在调用本地逻辑构建多维结构...</p>
                    </div>
                </div>

                <!-- Success State (Download Only) -->
                <div v-if="downloadUrl" class="text-center space-y-6 animate-fade-in-up z-10 max-w-sm w-full">
                    <div
                        class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto text-green-600 shadow-sm">
                        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    </div>

                    <div class="space-y-1">
                        <h3 class="text-xl font-bold text-slate-800">生成成功!</h3>
                        <p class="text-slate-500">您的思维导图已准备好</p>
                    </div>

                    <a :href="downloadUrl"
                        class="block w-full bg-slate-900 hover:bg-slate-800 text-white font-medium py-4 px-6 rounded-xl shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-1 flex items-center justify-center gap-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        <span>立即下载 .xmind</span>
                    </a>

                    <button @click="reset" class="text-sm text-slate-400 hover:text-slate-600 transition">
                        返回重新生成
                    </button>
                </div>

            </div>

        </main>
    </div>

    <script>
        const { createApp, ref } = Vue

        createApp({
            setup() {
                const rawText = ref('')
                const resultText = ref('')
                const apiKey = ref(localStorage.getItem('ai_xmind_key') || '')
                const baseUrl = ref(localStorage.getItem('ai_xmind_url') || '')
                const layout = ref('right')
                const showSettings = ref(true)
                const isLoading = ref(false)
                const downloadUrl = ref('')
                const statusMessage = ref('')

                const generate = async () => {
                    if (!rawText.value) return

                    isLoading.value = true
                    downloadUrl.value = ''
                    resultText.value = ''

                    // Update Status based on input
                    if (apiKey.value) {
                        statusMessage.value = "AI 正在思考并整理结构..."
                    } else {
                        statusMessage.value = "正在解析并生成文件..."
                    }

                    // Save Config
                    localStorage.setItem('ai_xmind_key', apiKey.value)
                    localStorage.setItem('ai_xmind_url', baseUrl.value)

                    try {
                        const response = await fetch('/api/generate', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                text: rawText.value,
                                api_key: apiKey.value,
                                base_url: baseUrl.value,
                                layout: layout.value
                            })
                        })

                        if (!response.ok) {
                            const err = await response.json()
                            throw new Error(err.detail || '请求失败')
                        }

                        const data = await response.json()
                        resultText.value = data.structured_text
                        downloadUrl.value = data.download_url

                    } catch (e) {
                        alert('错误: ' + e.message)
                    } finally {
                        isLoading.value = false
                    }
                }

                const copyResult = () => {
                    navigator.clipboard.writeText(resultText.value)
                }

                const reset = () => {
                    downloadUrl.value = ''
                    resultText.value = ''
                }

                return {
                    rawText,
                    resultText,
                    apiKey,
                    baseUrl,
                    layout,
                    showSettings,
                    isLoading,
                    downloadUrl,
                    statusMessage,
                    generate,
                    copyResult,
                    reset
                }
            }
        }).mount('#app')
    </script>
</body>

</html>